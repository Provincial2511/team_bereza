<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1565C0;
      --primary-dark: #0D47A1;
      --primary-light: #42A5F5;
      --success: #2E7D32;
      --success-light: #4CAF50;
      --warning: #ED6C02;
      --error: #C62828;
      --bg-gradient: linear-gradient(135deg, #3b60e9 40%, #72b2ef 60%);
      --paper: #FFFFFF;
      --text: #1A1A1A;
      --text-sec: #666666;
      --border: #E0E0E0;
      --shadow: 0 10px 40px rgba(0,0,0,0.15);
      --shadow-hover: 0 15px 50px rgba(0,0,0,0.2);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      color: var(--text);
      position: relative;
      overflow-x: hidden;
    }
    
    /* === –§–û–ù–û–í–û–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï === */
    .background-image {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }
    
    .background-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.4;
      filter: grayscale(10%) blur(2px);
      transition: opacity 0.3s ease;
    }
    
    .background-image::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(50, 63, 181, 0.35) 0%, rgba(71, 119, 161, 0.35) 100%);
    }
    
    /* Header */
    .header {
      background: var(--paper);
      padding: 16px 32px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-img {
      height: 48px;
      width: auto;
    }
    
    .logo-text {
      font-family: 'Roboto', sans-serif;
      font-size: 22px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary), var(--success));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .user-menu {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .mode-badge {
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
    }
    
    .user-info {
      text-align: right;
    }
    
    .user-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
    }
    
    .user-role {
      font-size: 12px;
      color: var(--text-sec);
    }
    
    .user-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--success));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    /* Main Content */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
      z-index: 1;
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .page-title {
      font-family: 'Roboto', sans-serif;
      font-size: 32px;
      font-weight: 700;
      color: white;
    }
    
    .page-actions {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Roboto', sans-serif;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 4px 16px rgba(21, 101, 192, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(21, 101, 192, 0.5);
    }
    
    .btn-outline {
      background: transparent;
      border: 3px solid var(--primary-dark);
      color: white;
    }
    
    .btn-outline:hover {
      background: var(--primary-dark);
      color: white;
    }
    
    .patient-summary {
      background: var(--paper);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary);
      max-width: 550px;
      margin-right: auto;
    }
    
    .patient-id {
      font-family: 'Roboto', sans-serif;
      font-size: 16px;
      background: #f4dddd;
      padding: 4px 12px;
      border-radius: 5px;
      font-style: normal;
      color: #1A1A1A;
    }
    
    .compliance-card {
      background: var(--paper);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      max-width: 900px;
      /* === –ò–ó–ú–ï–ù–ï–ù–ò–ï 1: –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å–ª–µ–≤–∞ (–∫–∞–∫ patient-summary) === */
      margin-right: auto;
    }
    
    .compliance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .compliance-title {
      font-family: 'Roboto', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
    }
    
    .progress-bar {
      height: 28px;
      background: #E0E0E0;
      border-radius: 14px;
      overflow: hidden;
      margin: 20px 0;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .progress-fill {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 15px;
      transition: width 1s ease-out;
    }
    
    .progress-success {
      background: linear-gradient(90deg, var(--success), var(--success-light));
    }
    
    .progress-warning {
      background: linear-gradient(90deg, var(--warning), #FF9800);
    }
    
    .stats {
      display: flex;
      gap: 32px;
      margin: 24px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .stat {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      font-weight: 500;
    }
    
    .stat.success { color: var(--success); }
    .stat.warning { color: var(--warning); }
    .stat.error { color: var(--error); }
    
    .section {
      background: var(--paper);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      padding-bottom: 16px;
      border-bottom: 2px solid #F0F0F0;
      margin-bottom: 16px;
    }
    
    .section-title {
      font-family: 'Roboto', sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .item {
      padding: 20px 0;
      border-bottom: 1px solid #F5F5F5;
      display: flex;
      gap: 20px;
    }
    
    .item:last-child {
      border-bottom: none;
    }
    
    .item-icon {
      width: 48px;
      height: 48px;
      border-radius: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: transparent;
      box-shadow: none;
    }
    
    .item-icon img {
      width: 100%;
      height: auto;
      object-fit: contain;
      border-radius: 0;
    }
    
    .item-content {
      flex: 1;
    }
    
    .item-title {
      font-family: 'Roboto', sans-serif;
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text);
    }
    
    /* –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Ä–∞—á–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
    .item-desc {
      font-family: 'Roboto', sans-serif;
      font-size: 15px;
      color: var(--text-sec);
      margin-bottom: 12px;
      line-height: 1.7;
      font-style: normal;
    }
    
    /* === –ò–ó–ú–ï–ù–ï–ù–ò–ï 2: –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) === */
    .item-desc-patient {
      display: none;
      font-family: 'Roboto', sans-serif;
      font-size: 15px;
      color: var(--text-sec);
      margin-bottom: 12px;
      line-height: 1.7;
      font-style: normal;
    }
    
    /* –í —Ä–µ–∂–∏–º–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞: –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏—è */
    body.patient-mode .item-desc {
      display: none;
    }
    
    body.patient-mode .item-desc-patient {
      display: block;
    }
    
    /* === –°–°–´–õ–ö–ò –ù–ê –ö–õ–ò–ù–ò–ß–ï–°–ö–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ä–∞—á–∞) === */
    .guideline-link {
      font-size: 13px;
      color: var(--primary);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: #E3F2FD;
      border-radius: 8px;
      transition: all 0.2s ease;
      font-weight: 500;
      margin-top: 8px;
    }
    
    .guideline-link:hover {
      background: var(--primary);
      color: white;
    }
    
    /* === –°–ö–†–´–í–ê–ï–ú –°–°–´–õ–ö–ò –í –†–ï–ñ–ò–ú–ï –ü–ê–¶–ò–ï–ù–¢–ê === */
    body.patient-mode .guideline-link {
      display: none !important;
    }
    
    .badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: inline-block;
    }
    
    .badge.success {
      background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
      color: var(--success);
    }
    
    .badge.warning {
      background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
      color: var(--warning);
    }
    
    .badge.error {
      background: linear-gradient(135deg, #FFEBEE, #FFCDD2);
      color: var(--error);
    }
    
    .badge.info {
      background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
      color: var(--primary);
    }
    
    /* === –°–ï–ö–¶–ò–Ø –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–• –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô === */
    .recommendation-item {
      padding: 16px;
      background: #F8F9FA;
      border-radius: 12px;
      margin-bottom: 12px;
      border-left: 3px solid var(--warning);
    }
    
    .recommendation-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text);
    }
    
    .recommendation-desc {
      font-size: 14px;
      color: var(--text-sec);
      line-height: 1.6;
    }
    
    /* === AI RESPONSE CARD === */
    .ai-response-card {
      background: var(--paper);
      border-radius: 20px;
      padding: 28px 32px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    .ai-response-card h3 {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ai-response-text {
      font-size: 15px;
      line-height: 1.75;
      color: var(--text);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .ai-response-loading {
      color: var(--text-sec);
      font-size: 15px;
      padding: 16px 0;
    }

    /* === –ß–ê–¢-–ü–ê–ù–ï–õ–¨ === */
    .chat-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      z-index: 1100;
    }

    .chat-overlay.open { display: block; }

    .chat-panel {
      position: fixed;
      top: 0;
      right: -420px;
      width: 420px;
      max-width: 100vw;
      height: 100vh;
      background: var(--paper);
      box-shadow: -8px 0 32px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      z-index: 1200;
      transition: right 0.3s ease;
    }

    .chat-panel.open { right: 0; }

    .chat-panel-header {
      padding: 18px 20px;
      background: linear-gradient(135deg, #9C27B0, #7B1FA2);
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .chat-panel-header span {
      font-weight: 700;
      font-size: 16px;
    }

    .chat-close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 22px;
      cursor: pointer;
      line-height: 1;
      padding: 0 4px;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .chat-msg {
      max-width: 88%;
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.6;
      word-break: break-word;
      white-space: pre-wrap;
    }

    .chat-msg.user {
      align-self: flex-end;
      background: linear-gradient(135deg, #1565C0, #42A5F5);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .chat-msg.assistant {
      align-self: flex-start;
      background: #F3E5F5;
      color: var(--text);
      border-bottom-left-radius: 4px;
    }

    .chat-msg.typing {
      align-self: flex-start;
      background: #F3E5F5;
      color: var(--text-sec);
      font-style: italic;
    }

    .chat-input-row {
      padding: 12px 16px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
      flex-shrink: 0;
    }

    .chat-input-row input {
      flex: 1;
      padding: 10px 14px;
      border: 1.5px solid var(--border);
      border-radius: 24px;
      font-size: 14px;
      font-family: 'Roboto', sans-serif;
      outline: none;
      transition: border-color 0.2s;
    }

    .chat-input-row input:focus { border-color: #9C27B0; }

    .chat-send-btn {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: linear-gradient(135deg, #9C27B0, #7B1FA2);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: opacity 0.2s;
    }

    .chat-send-btn:disabled { opacity: 0.5; cursor: default; }

    @media (max-width: 480px) {
      .chat-panel { width: 100vw; }
    }

    /* === –ö–ù–û–ü–ö–ê –ß–ê–¢–ê –° LLM === */
    .llm-chat-fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #9C27B0, #7B1FA2);
      color: white;
      border: none;
      box-shadow: 0 8px 24px rgba(156, 39, 176, 0.5);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .llm-chat-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 32px rgba(156, 39, 176, 0.6);
    }
    
    .llm-chat-fab .tooltip {
      position: absolute;
      bottom: 70px;
      right: 0;
      background: var(--paper);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      box-shadow: var(--shadow);
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }
    
    .llm-chat-fab:hover .tooltip {
      opacity: 1;
    }
    
    /* Disclaimer */
    .disclaimer {
      margin: 60px auto 0 auto;
      border-left: 4px solid var(--warning);
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 16px;
      backdrop-filter: blur(10px);
      animation: fadeInUp 0.8s ease-out 0.6s both;
      max-width: 700px;
      width: 100%;
    }
    
    .disclaimer-text {
      font-size: 13px;
      color: rgba(255,255,255,0.9);
      line-height: 1.6;
      text-align: center;
    }
    
    .disclaimer-text strong {
      color: white;
      font-weight: normal;
    }
    
    /* Back Button */
    .back-button {
      position: fixed;
      bottom: 24px;
      left: 24px;
      padding: 12px 24px;
      background: var(--paper);
      border-radius: 50px;
      box-shadow: var(--shadow);
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      z-index: 100;
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
    }
    
    .back-button:hover {
      transform: translateX(-4px);
      box-shadow: var(--shadow-hover);
    }
    
    @media (max-width: 768px) {
      .header { padding: 12px 16px; }
      .page-title { font-size: 24px; }
      .stats { flex-direction: column; gap: 16px; }
      .llm-chat-fab { width: 52px; height: 52px; font-size: 24px; }
      .disclaimer { max-width: 100%; }
    }
    
    @media (max-width: 480px) {
      .background-image img { opacity: 0.08; }
    }
  </style>
</head>
<body>
  
  <!-- –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
  <div class="background-image" aria-hidden="true">
    <img src="assets/images/background-main.png" alt="" onerror="this.src='https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=1920&h=1080&fit=crop'">
  </div>
  
  <!-- Header -->
  <header class="header">
    <div class="logo-container">
      <img src="assets/images/logo2.png" alt="OncoAI" class="logo-img" onerror="this.src='https://via.placeholder.com/48x48/667eea/ffffff?text=O'">
      <span class="logo-text"></span>
    </div>
    <div class="user-menu">
      <span class="mode-badge" id="modeBadge">–î–ª—è –≤—Ä–∞—á–µ–π</span>
      <div class="user-info">
        <div class="user-name">–î–æ–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤ –ê.–°.</div>
        <div class="user-role" id="userRole">–í—Ä–∞—á-–æ–Ω–∫–æ–ª–æ–≥</div>
      </div>
      <div class="user-avatar">–ò</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è</h1>
        <p style="color: white; margin-top: 8px;">
          –ü–∞—Ü–∏–µ–Ω—Ç ID: <span class="patient-id" id="patientId">ONC-2026-0847</span> | 
          –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: <span id="checkDate">24.02.2026</span>
        </p>
      </div>
      <div class="page-actions">
        <button class="btn btn-outline" onclick="window.location.href='upload.html'">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
        <button class="btn btn-primary" onclick="exportReport()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–∞</button>
      </div>
    </div>
    
    <!-- Patient Summary -->
    <div class="patient-summary" id="patientSummary">
      <strong>üìã –î–∏–∞–≥–Ω–æ–∑:</strong> –†–∞–∫ –º–æ–ª–æ—á–Ω–æ–π –∂–µ–ª–µ–∑—ã, pT2N1M0, HER2+, LumB <br>
      <strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> 54 –≥–æ–¥–∞ <br>
      <strong>–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è:</strong> –ì–ë II —Å—Ç., –°–î 2
    </div>
    
    <!-- Overall Compliance ‚Äî –í–´–†–û–í–ù–ï–ù –°–õ–ï–í–ê -->
    <div class="compliance-card">
      <div class="compliance-header">
        <h2 class="compliance-title">
          <img src="assets/images/icon-diagnostics.png" alt="üìä" style="width:28px;height:28px;object-fit:contain;vertical-align:middle;margin-right:8px" onerror="this.src='https://via.placeholder.com/28/1565C0/ffffff?text=üìä'">
          –û–±—â–µ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º
        </h2>
        <span class="badge warning" id="overallBadge">82%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill progress-warning" style="width: 82%;" id="overallProgress">82%</div>
      </div>
      <div class="stats">
        <div class="stat success">
          <img src="assets/images/accept-icon.png" alt="‚úì" style="width:20px;height:20px;object-fit:contain" onerror="this.src='https://via.placeholder.com/20/4CAF50/ffffff?text=‚úì'">
          <span id="statOk">18</span> –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
        </div>
        <div class="stat warning">
          <img src="assets/images/icon-safety.png" alt="‚ö†Ô∏è" style="width:20px;height:20px;object-fit:contain" onerror="this.src='https://via.placeholder.com/20/ED6C02/ffffff?text=‚ö†Ô∏è'">
          <span id="statWarning">5</span> —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è
        </div>
        <div class="stat error">
          <img src="assets/images/decline-icon.png" alt="‚úï" style="width:20px;height:20px;object-fit:contain" onerror="this.src='https://via.placeholder.com/20/C62828/ffffff?text=‚úï'">
          <span id="statError">2</span> –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
        </div>
      </div>
    </div>
    
    <!-- AI Response Card -->
    <div class="ai-response-card" id="aiResponseCard">
      <h3>ü§ñ –ê–Ω–∞–ª–∏–∑ AI</h3>
      <div class="ai-response-loading" id="aiResponseLoading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞...</div>
      <div class="ai-response-text" id="aiResponseText" style="display:none;"></div>
    </div>

    <!-- Diagnostics Section ‚Äî –° –£–ü–†–û–©–Å–ù–ù–´–ú–ò –û–ë–™–Ø–°–ù–ï–ù–ò–Ø–ú–ò –î–õ–Ø –ü–ê–¶–ò–ï–ù–¢–ê -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('diagnostics')">
        <h3 class="section-title">
          <img src="assets/images/icon-diagnostics.png" alt="üî¨" style="width:32px;height:32px;object-fit:contain" onerror="this.src='https://via.placeholder.com/32/1565C0/ffffff?text=üî¨'">
          –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
          <span class="badge success" id="diagBadge">100%</span>
        </h3>
        <span id="diagArrow" style="cursor: pointer; font-size: 20px;">‚ñº</span>
      </div>
      <div id="diagnostics">
        <div class="item">
          <div class="item-icon">
            <img src="assets/images/accept-icon.png" alt="‚úì" onerror="this.src='https://via.placeholder.com/48/4CAF50/ffffff?text=‚úì'">
          </div>
          <div class="item-content">
            <h4 class="item-title">–ì–∏—Å—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ–∑–∞</h4>
            <!-- –î–ª—è –≤—Ä–∞—á–∞ -->
            <p class="item-desc">–ê–¥–µ–Ω–æ–∫–∞—Ä—Ü–∏–Ω–æ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –±–∏–æ–ø—Å–∏–µ–π –æ—Ç 03.03.2025</p>
            <!-- –î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ) -->
            <p class="item-desc-patient">–ó–ª–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (–∞–¥–µ–Ω–æ–∫–∞—Ä—Ü–∏–Ω–æ–º–∞) –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –º–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º —Ç–∫–∞–Ω–∏ –æ—Ç 03.03.2025</p>
            <a href="https://russco.ru/clinical-recommendations" target="_blank" class="guideline-link">
              üìö RUSSCO 2024, –ø.3.2.1 ‚Üí
            </a>
          </div>
        </div>
        <div class="item">
          <div class="item-icon">
            <img src="assets/images/accept-icon.png" alt="‚úì" onerror="this.src='https://via.placeholder.com/48/4CAF50/ffffff?text=‚úì'">
          </div>
          <div class="item-content">
            <h4 class="item-title">–ò–º–º—É–Ω–æ–≥–∏—Å—Ç–æ—Ö–∏–º–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (–ò–ì–•)</h4>
            <!-- –î–ª—è –≤—Ä–∞—á–∞ -->
            <p class="item-desc">HER2-—Å—Ç–∞—Ç—É—Å 3+, PD-L1 CPS=8, MSI-—Å—Ç–∞—Ç—É—Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</p>
            <!-- –î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ) -->
            <p class="item-desc-patient">–ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –±–µ–ª–∫–∏ –µ—Å—Ç—å –≤ –æ–ø—É—Ö–æ–ª–∏, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ. –í—ã—è–≤–ª–µ–Ω—ã: HER2-—Å—Ç–∞—Ç—É—Å 3+, PD-L1 CPS=8, MSI-—Å—Ç–∞—Ç—É—Å</p>
            <a href="https://russco.ru/clinical-recommendations" target="_blank" class="guideline-link">
              üìö RUSSCO 2024, –ø.3.2.4 ‚Üí
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Therapy Section ‚Äî –° –£–ü–†–û–©–Å–ù–ù–´–ú–ò –û–ë–™–Ø–°–ù–ï–ù–ò–Ø–ú–ò –î–õ–Ø –ü–ê–¶–ò–ï–ù–¢–ê -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('therapy')">
        <h3 class="section-title">
          <img src="assets/images/icon-therapy.png" alt="üíä" style="width:32px;height:32px;object-fit:contain" onerror="this.src='https://via.placeholder.com/32/2E7D32/ffffff?text=üíä'">
          –¢–µ—Ä–∞–ø–∏—è
          <span class="badge warning" id="therapyBadge">75%</span>
        </h3>
        <span id="therapyArrow" style="cursor: pointer; font-size: 20px;">‚ñº</span>
      </div>
      <div id="therapy" style="display: none;">
        <div class="item">
          <div class="item-icon">
            <img src="assets/images/accept-icon.png" alt="‚úì" onerror="this.src='https://via.placeholder.com/48/4CAF50/ffffff?text=‚úì'">
          </div>
          <div class="item-content">
            <h4 class="item-title">1 –ª–∏–Ω–∏—è —Ç–µ—Ä–∞–ø–∏–∏: TC + –¢—Ä–∞—Å—Ç—É–∑—É–º–∞–±</h4>
            <!-- –î–ª—è –≤—Ä–∞—á–∞ -->
            <p class="item-desc">6 –∫—É—Ä—Å–æ–≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ (05.25–≥ ‚Äî 09.25–≥). –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –¥–ª—è HER2+ –æ–ø—É—Ö–æ–ª–∏</p>
            <!-- –î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ) -->
            <p class="item-desc-patient">–ü–µ—Ä–≤–æ–µ –ª–µ—á–µ–Ω–∏–µ: –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –¥–≤—É—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–∑–Ω–∞–Ω—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–∏ –ª–µ—á–µ–Ω–∏–∏ –≤–∞—à–µ–≥–æ —Ç–∏–ø–∞ –æ–ø—É—Ö–æ–ª–∏ (HER2+)</p>
            <a href="https://russco.ru/clinical-recommendations" target="_blank" class="guideline-link">
              üìö RUSSCO 2024, –ø.4.3.2 ‚Üí
            </a>
          </div>
        </div>
        <div class="item">
          <div class="item-icon">
            <img src="assets/images/decline-icon.png" alt="‚úï" onerror="this.src='https://via.placeholder.com/48/C62828/ffffff?text=‚úï'">
          </div>
          <div class="item-content">
            <h4 class="item-title">2 –ª–∏–Ω–∏—è —Ç–µ—Ä–∞–ø–∏–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
            <!-- –î–ª—è –≤—Ä–∞—á–∞ -->
            <p class="item-desc">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω –¢—Ä–∞—Å—Ç—É–∑—É–º–∞–± –¥–µ—Ä—É–∫—Å—Ç–µ–∫–∞–Ω (T-DXd) —Å–æ–≥–ª–∞—Å–Ω–æ DESTINY-Gastric01</p>
            <!-- –î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ) -->
            <p class="item-desc-patient">–í—Ä–∞—á–æ–º –±—ã–ª –ø—Ä–µ–¥–ª–æ–∂–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç (–¢—Ä–∞—Å—Ç—É–∑—É–º–∞–± –¥–µ—Ä—É–∫—Å—Ç–µ–∫–∞–Ω (T-DXd)) –ø–æ—Å–ª–µ —Å–Ω–∏–∂–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –ø–µ—Ä–≤–æ–π –ª–∏–Ω–∏–∏ —Ç–µ—Ä–∞–ø–∏–∏</p>
            <a href="https://www.nccn.org/guidelines" target="_blank" class="guideline-link">
              üìö NCCN Gastric Cancer v2.2024, –ø.4.5.1 ‚Üí
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Safety/Quality Control Section ‚Äî –° –£–ü–†–û–©–Å–ù–ù–´–ú–ò –û–ë–™–Ø–°–ù–ï–ù–ò–Ø–ú–ò –î–õ–Ø –ü–ê–¶–ò–ï–ù–¢–ê -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('safety')">
        <h3 class="section-title">
          <img src="assets/images/icon-safety.png" alt="‚ö†Ô∏è" style="width:32px;height:32px;object-fit:contain" onerror="this.src='https://via.placeholder.com/32/ED6C02/ffffff?text=‚ö†Ô∏è'">
          –ö–æ–Ω—Ç—Ä–æ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
          <span class="badge warning" id="safetyBadge">85%</span>
        </h3>
        <span id="safetyArrow" style="cursor: pointer; font-size: 20px;">‚ñº</span>
      </div>
      <div id="safety" style="display: none;">
        <div class="item">
          <div class="item-icon">
            <img src="assets/images/accept-icon.png" alt="‚úì" onerror="this.src='https://via.placeholder.com/48/4CAF50/ffffff?text=‚úì'">
          </div>
          <div class="item-content">
            <h4 class="item-title">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—Ä–¥–∏–æ—Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏</h4>
            <!-- –î–ª—è –≤—Ä–∞—á–∞ -->
            <p class="item-desc">–≠—Ö–æ–ö–ì –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ç–µ—Ä–∞–ø–∏–∏ –¢—Ä–∞—Å—Ç—É–∑—É–º–∞–±–æ–º</p>
            <!-- –î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ) -->
            <p class="item-desc-patient">–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ç–µ—Ä–∞–ø–∏–∏ –¢—Ä–∞—Å—Ç—É–∑—É–º–∞–±–æ–º –≤—Ä–∞—á –ø—Ä–æ–≤–µ—Ä–∏–ª —Ä–∞–±–æ—Ç—É —Å–µ—Ä–¥—Ü–∞ (–≠—Ö–æ–ö–ì), —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏ —Ç–µ—Ä–∞–ø–∏–∏</p>
            <a href="https://russco.ru/clinical-recommendations" target="_blank" class="guideline-link">
              üìö RUSSCO 2024, –ø.4.3.1 ‚Üí
            </a>
          </div>
        </div>
        <div class="item">
          <div class="item-icon">
            <img src="assets/images/icon-safety.png" alt="‚ö†Ô∏è" onerror="this.src='https://via.placeholder.com/48/ED6C02/ffffff?text=‚ö†Ô∏è'">
          </div>
          <div class="item-content">
            <h4 class="item-title">–ö–æ–Ω—Ç—Ä–æ–ª—å –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</h4>
            <!-- –î–ª—è –≤—Ä–∞—á–∞ -->
            <p class="item-desc">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–µ–π —Ç–µ—Ä–∞–ø–∏–µ–π (–ì–ë, –°–î)</p>
            <!-- –î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ) -->
            <p class="item-desc-patient">–í—Ä–∞—á—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ç–µ–∫—É—â–∏—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ (–∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –¥–ª—è –ª–µ—á–µ–Ω–∏—è —Å–æ–ø—É—Ç—Å–≤—É—é—â–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π) –∏ —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤</p>
            <a href="https://minzdrav.gov.ru/clinical-recommendations" target="_blank" class="guideline-link">
              üìö –ú–∏–Ω–∑–¥—Ä–∞–≤ –†–§, –ö–† 2024, –ø.5.2.3 ‚Üí
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Additional Recommendations Section -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('recommendations')">
        <h3 class="section-title">
          <img src="assets/images/icon-safety.png" alt="üí°" style="width:32px;height:32px;object-fit:contain" onerror="this.src='https://via.placeholder.com/32/ED6C02/ffffff?text=üí°'">
          –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
          <span class="badge info" id="recBadge">3</span>
        </h3>
        <span id="recArrow" style="cursor: pointer; font-size: 20px;">‚ñº</span>
      </div>
      <div id="recommendations" style="display: none;">
        <div class="recommendation-item">
          <div class="recommendation-title">üß¨ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</div>
          <p class="recommendation-desc">
            –î–ª—è HER2+ CUP-—Å–∏–Ω–¥—Ä–æ–º–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–Ω—Ç–∏-HER2 –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Zanidatamab, Trastuzumab Deruxtecan –≤ –Ω–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏—è—Ö).
          </p>
          <a href="https://clinicaltrials.gov" target="_blank" class="guideline-link" style="margin-top: 8px;">
            üîç –ü–æ–∏—Å–∫ trials –Ω–∞ ClinicalTrials.gov
          </a>
        </div>
        <div class="recommendation-item">
          <div class="recommendation-title">
            <img src="assets/images/icon-safety.png" alt="‚ö†Ô∏è" style="width:18px;height:18px;object-fit:contain;vertical-align:middle;margin-right:4px" onerror="this.src='https://via.placeholder.com/18/ED6C02/ffffff?text=‚ö†Ô∏è'">
            –ö–æ–Ω—Ç—Ä–æ–ª—å –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
          </div>
          <p class="recommendation-desc">
            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–π —Ç–µ—Ä–∞–ø–∏–∏ —Å —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞–º–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –ì–ë, –°–î).
          </p>
        </div>
        <div class="recommendation-item">
          <div class="recommendation-title">üìÖ –ü–ª–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</div>
          <p class="recommendation-desc">
            –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ö–¢/–ü–≠–¢-–ö–¢ –∫–∞–∂–¥—ã–µ 2-3 —Ü–∏–∫–ª–∞ —Ç–µ—Ä–∞–ø–∏–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ—Ç–≤–µ—Ç–∞. –ö–æ–Ω—Ç—Ä–æ–ª—å –≠—Ö–æ–ö–ì –∫–∞–∂–¥—ã–µ 3 –º–µ—Å—è—Ü–∞ –ø—Ä–∏ —Ç–µ—Ä–∞–ø–∏–∏ –¢—Ä–∞—Å—Ç—É–∑—É–º–∞–±–æ–º.
          </p>
          <a href="https://russco.ru/clinical-recommendations" target="_blank" class="guideline-link" style="margin-top: 8px;">
            üìö RUSSCO 2024, –ø.5.1.2 ‚Üí
          </a>
        </div>
      </div>
    </div>
    
    <!-- Disclaimer -->
    <div class="disclaimer">
      <p class="disclaimer-text">
        <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> "OncoCheck Assist" - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π.<br> 
        –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É.<br> 
        –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ –¥–∏–∞–≥–Ω–æ–∑–µ –∏ —Ç–∞–∫—Ç–∏–∫–µ –ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–µ—á–∞—â–∏–π –≤—Ä–∞—á.
      </p>
    </div>
  </div>
  
  <!-- Back Button -->
  <div class="back-button" onclick="window.location.href='upload.html'">
    ‚Üê –ù–∞–∑–∞–¥
  </div>
  
  <!-- Chat overlay -->
  <div class="chat-overlay" id="chatOverlay" onclick="closeChatPanel()"></div>

  <!-- Chat panel -->
  <div class="chat-panel" id="chatPanel">
    <div class="chat-panel-header">
      <span>üí¨ AI-–ø–æ–º–æ—â–Ω–∏–∫</span>
      <button class="chat-close-btn" onclick="closeChatPanel()">‚úï</button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-row">
      <input
        type="text"
        id="chatInput"
        placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º..."
        onkeydown="if(event.key==='Enter') sendChatMessage()"
      />
      <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()">‚û§</button>
    </div>
  </div>

  <!-- LLM Chat Button -->
  <button class="llm-chat-fab" onclick="openChatPanel()" title="–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å AI">
    üí¨
    <span class="tooltip">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º</span>
  </button>

  <script>
    // --- Accordion ---
    function toggleSection(sectionId) {
      const content = document.getElementById(sectionId);
      const arrow   = document.getElementById(sectionId + 'Arrow');
      const open    = content.style.display === 'block';
      content.style.display = open ? 'none' : 'block';
      arrow.textContent     = open ? '‚ñ∂' : '‚ñº';
    }

    function exportReport() {
      alert('üì§ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF-–æ—Ç—á—ë—Ç–∞...\n\n–í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.');
    }

    // --- Chat panel ---
    function openChatPanel() {
      document.getElementById('chatPanel').classList.add('open');
      document.getElementById('chatOverlay').classList.add('open');
      document.getElementById('chatInput').focus();
    }

    function closeChatPanel() {
      document.getElementById('chatPanel').classList.remove('open');
      document.getElementById('chatOverlay').classList.remove('open');
    }

    function appendMessage(role, text) {
      const box = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'chat-msg ' + role;
      div.textContent = text;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
      return div;
    }

    async function sendChatMessage() {
      const input   = document.getElementById('chatInput');
      const sendBtn = document.getElementById('chatSendBtn');
      const text    = input.value.trim();
      if (!text) return;

      const sessionId = localStorage.getItem('oncoai_session_id');
      if (!sessionId) {
        appendMessage('assistant', '–°–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Å–Ω–æ–≤–∞.');
        return;
      }

      appendMessage('user', text);
      input.value   = '';
      input.disabled = true;
      sendBtn.disabled = true;

      const typingDiv = appendMessage('typing', '...');

      try {
        const res = await fetch('/api/chat', {
          method:  'POST',
          headers: { 'Content-Type': 'application/json' },
          body:    JSON.stringify({ session_id: sessionId, message: text }),
        });

        typingDiv.remove();

        if (!res.ok) {
          const err = await res.json().catch(() => ({ detail: res.statusText }));
          appendMessage('assistant', '‚ö†Ô∏è ' + (err.detail || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'));
        } else {
          const data = await res.json();
          appendMessage('assistant', data.reply);
        }
      } catch (err) {
        typingDiv.remove();
        appendMessage('assistant', '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + err.message);
      } finally {
        input.disabled  = false;
        sendBtn.disabled = false;
        input.focus();
      }
    }

    // --- Structured data rendering ---

    function populateStructured(s) {
      // Patient summary
      if (s.patient_info) {
        const pi = s.patient_info;
        const el = document.getElementById('patientSummary');
        if (el) {
          el.innerHTML =
            '<strong>üìã –î–∏–∞–≥–Ω–æ–∑:</strong> ' + (pi.diagnosis || '‚Äî') + ' <br>' +
            '<strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ' + (pi.age || '‚Äî') + ' <br>' +
            '<strong>–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è:</strong> ' + (pi.comorbidities || '‚Äî');
        }
      }

      // Overall score
      if (s.overall_score != null) {
        const score = Math.min(100, Math.max(0, Math.round(s.overall_score)));
        const badge = document.getElementById('overallBadge');
        const prog  = document.getElementById('overallProgress');
        if (badge) {
          badge.textContent = score + '%';
          badge.className   = score >= 80 ? 'badge success' : score >= 60 ? 'badge warning' : 'badge error';
        }
        if (prog) {
          prog.textContent = score + '%';
          setTimeout(() => { prog.style.width = score + '%'; }, 150);
          prog.className = 'progress-fill ' + (score >= 80 ? 'progress-success' : 'progress-warning');
        }
      }

      // Summary stats
      const allItems = [
        ...(s.diagnostics || []),
        ...(s.therapy     || []),
        ...(s.safety      || []),
      ];
      const okCount      = allItems.filter(i => i.status === 'ok').length;
      const warningCount = allItems.filter(i => i.status === 'warning').length;
      const errorCount   = allItems.filter(i => i.status === 'error').length;
      const statOk = document.getElementById('statOk');
      const statW  = document.getElementById('statWarning');
      const statE  = document.getElementById('statError');
      if (statOk) statOk.textContent = okCount;
      if (statW)  statW.textContent  = warningCount;
      if (statE)  statE.textContent  = errorCount;

      // Sections
      if (s.diagnostics)    renderSection('diagnostics',    s.diagnostics,    'diagBadge');
      if (s.therapy)        renderSection('therapy',        s.therapy,        'therapyBadge');
      if (s.safety)         renderSection('safety',         s.safety,         'safetyBadge');
      if (s.recommendations) renderRecommendations(s.recommendations);
    }

    function _statusIcon(status) {
      if (status === 'ok')    return { src: 'assets/images/accept-icon.png',  alt: '‚úì', color: '4CAF50' };
      if (status === 'error') return { src: 'assets/images/decline-icon.png', alt: '‚úï', color: 'C62828' };
      return                         { src: 'assets/images/icon-safety.png',  alt: '‚ö†Ô∏è', color: 'ED6C02' };
    }

    function renderSection(sectionId, items, badgeId) {
      const container = document.getElementById(sectionId);
      if (!container) return;

      const okCount = items.filter(i => i.status === 'ok').length;
      const score   = items.length > 0 ? Math.round(okCount / items.length * 100) : 100;
      const badge   = document.getElementById(badgeId);
      if (badge) {
        badge.textContent = score + '%';
        badge.className   = score >= 80 ? 'badge success' : score >= 60 ? 'badge warning' : 'badge error';
      }

      container.innerHTML = items.map(item => {
        const ic = _statusIcon(item.status || 'ok');
        return (
          '<div class="item">' +
          '  <div class="item-icon">' +
          '    <img src="' + ic.src + '" alt="' + ic.alt + '"' +
          '         onerror="this.src=\'https://via.placeholder.com/48/' + ic.color + '/ffffff?text=' + ic.alt + '\'">' +
          '  </div>' +
          '  <div class="item-content">' +
          '    <h4 class="item-title">' + item.title + '</h4>' +
          '    <p class="item-desc">' + item.description + '</p>' +
          '    <p class="item-desc-patient">' + item.description + '</p>' +
          '  </div>' +
          '</div>'
        );
      }).join('');
    }

    function renderRecommendations(items) {
      const container = document.getElementById('recommendations');
      if (!container) return;
      const badge = document.getElementById('recBadge');
      if (badge) badge.textContent = items.length;
      container.innerHTML = items.map(item =>
        '<div class="recommendation-item">' +
        '  <div class="recommendation-title">' + item.title + '</div>' +
        '  <p class="recommendation-desc">' + item.description + '</p>' +
        '</div>'
      ).join('');
    }

    // --- Init ---
    window.addEventListener('DOMContentLoaded', () => {
      const mode      = localStorage.getItem('oncoai_mode') || 'doctor';
      const modeBadge = document.getElementById('modeBadge');

      if (mode === 'patient') {
        document.body.classList.add('patient-mode');
        modeBadge.textContent = '–†–µ–∂–∏–º –ø–∞—Ü–∏–µ–Ω—Ç–∞';
        modeBadge.style.background = 'linear-gradient(135deg, #2E7D32, #4CAF50)';
      } else {
        document.body.classList.remove('patient-mode');
        modeBadge.textContent = '–†–µ–∂–∏–º –≤—Ä–∞—á–∞';
        modeBadge.style.background = 'linear-gradient(135deg, #1565C0, #42A5F5)';
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å AI-–æ—Ç–≤–µ—Ç –∏–∑ localStorage
      const response = localStorage.getItem('oncoai_response');
      const loading  = document.getElementById('aiResponseLoading');
      const textEl   = document.getElementById('aiResponseText');

      if (response) {
        loading.style.display = 'none';
        textEl.textContent    = response;
        textEl.style.display  = 'block';
      } else {
        loading.textContent = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –ø–∞—Ü–∏–µ–Ω—Ç–∞.';
      }

      // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –∏–∑ structured JSON
      const structuredRaw = localStorage.getItem('oncoai_structured');
      if (structuredRaw) {
        try {
          const structured = JSON.parse(structuredRaw);
          populateStructured(structured);
        } catch (e) {
          console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å structured JSON:', e);
          // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ fallback
        }
      }

      // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
      appendMessage('assistant',
        '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞. ' +
        '–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∞–Ω–∞–ª–∏–∑–∞.'
      );

      // –ê–Ω–∏–º–∞—Ü–∏—è progress bar (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ structured –Ω–µ –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω)
      if (!structuredRaw) {
        setTimeout(() => {
          const progress = document.getElementById('overallProgress');
          if (progress) {
            progress.style.width = '0%';
            setTimeout(() => { progress.style.width = '82%'; }, 100);
          }
        }, 500);
      }
    });
  </script>
</body>
</html>